<!-- views/index.erb -->
<!DOCTYPE html>
<html>
  <head>
    <title>Word Counter with Advice API</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
      body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        max-width: 800px; 
        margin: 0 auto; 
        padding: 20px; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      }
      h1 {
        color: #333;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .subtitle {
        color: #666;
        margin-bottom: 30px;
      }
      .text-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      textarea { 
        width: 100%; 
        height: 200px; 
        margin: 15px 0;
        padding: 20px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        transition: all 0.3s;
        resize: vertical;
      }
      textarea:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
      }
      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin: 20px 0;
      }
      button { 
        padding: 12px 25px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      }
      .btn-warning {
        background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
      }
      .btn-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      }
      .stats { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px; 
        margin: 30px 0;
      }
      .stat { 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 10px;
        text-align: center;
        transition: transform 0.3s;
      }
      .stat:hover {
        transform: translateY(-5px);
      }
      .stat h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .stat-value {
        font-size: 36px;
        font-weight: bold;
      }
      .api-box {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 10px;
        margin: 30px 0;
        border-left: 5px solid #667eea;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      }
      .api-box h3 {
        color: #667eea;
        margin-top: 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .api-label {
        font-size: 12px;
        color: #6c757d;
        margin-top: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: bold;
      }
      .error-box {
        background: #ffe6e6;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid #ff6b6b;
      }
      .word-list {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin: 20px 0;
      }
      .word-tag {
        background: #e6f3ff;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 14px;
        color: #667eea;
        border: 1px solid #667eea;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
      }
      .word-tag:hover {
        background: #667eea;
        color: white;
      }
      .word-count {
        background: #667eea;
        color: white;
        padding: 2px 10px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
      }
      .reading-time {
        background: #fff9db;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid #ffd43b;
      }
      .text-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 5px;
        font-size: 14px;
        color: #666;
      }
      .char-count {
        font-weight: bold;
        color: #667eea;
      }
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>
        <span></span>
        Word Counter with Advice API
      </h1>
      <p class="subtitle">Analyze your text and get helpful advice automatically</p>
      
      <div class="text-controls">
        <h3>Enter your text:</h3>
        <div class="text-meta">
          <span id="char-count">0 characters</span>
        </div>
      </div>
      
      <form id="text-form" action="/analyze" method="POST">
        <textarea id="text-input" name="text" placeholder="Enter your text here to analyze... Or use the buttons below to load sample text or advice."><%= @text %></textarea>
        
        <div class="button-group">
          <button type="submit" class="btn-primary" id="analyze-btn">
            <span></span>
            Analyze Text
          </button>
          <button type="button" class="btn-success" id="load-advice-btn">
            <span></span>
            Load Random Advice
          </button>
          <button type="button" class="btn-warning" id="sample-text-btn">
            <span></span>
            Load Sample Text
          </button>
          <button type="button" class="btn-secondary" id="clear-btn">
            <span></span>
            Clear Text
          </button>
        </div>
      </form>
      
      <% if @word_count %>
        <h2>Analysis Results</h2>
        
        <div class="stats">
          <div class="stat">
            <div class="stat-value"><%= @word_count %></div>
            <h3>Words</h3>
          </div>
          <div class="stat">
            <div class="stat-value"><%= @char_count %></div>
            <h3>Characters</h3>
          </div>
          <div class="stat">
            <div class="stat-value"><%= @sentence_count %></div>
            <h3>Sentences</h3>
          </div>
          <div class="stat">
            <div class="stat-value"><%= @paragraph_count %></div>
            <h3>Paragraphs</h3>
          </div>
        </div>
        
        <div class="reading-time">
          <p><strong>Reading Time:</strong> <%= @reading_time %> minute<%= @reading_time == 1 ? '' : 's' %> (at 200 words per minute)</p>
        </div>
        
        <% if @common_words.any? %>
          <h3>Most Common Words:</h3>
          <div class="word-list">
            <% @common_words.each do |word, count| %>
              <span class="word-tag">
                <%= word %> <span class="word-count"><%= count %></span>
              </span>
            <% end %>
          </div>
        <% end %>
        
        <!-- Dictionary API Result -->
        <% if @word_definitions.any? %>
          <div class="api-box">
            <h3><span></span> Dictionary Definitions:</h3>
            <% @word_definitions.each do |definition| %>
              <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #e0e0e0;">
                <h4 style="color: #667eea; margin-bottom: 8px;">
                  <%= definition[:word].capitalize %>
                </h4>
                <p style="margin: 0;"><%= definition[:definition] %></p>
              </div>
            <% end %>
            <div class="api-label">Powered by Dictionary API</div>
          </div>
        <% end %>
        
        <!-- Advice Slip API Result -->
        <% if @advice %>
          <% if @advice[:success] %>
            <div class="api-box">
              <h3><span></span> Random Advice #<%= @advice[:id] %>:</h3>
              <p style="font-size: 18px; line-height: 1.6; font-style: italic;">"<%= @advice[:advice] %>"</p>
              <div class="api-label">Powered by Advice Slip API</div>
            </div>
          <% else %>
            <div class="error-box">
              <p>Could not fetch advice: <%= @advice[:error] %></p>
            </div>
          <% end %>
        <% end %>
      <% end %>
      
      <!-- API Information -->
      <div style="margin-top: 40px; padding: 20px; background: #f1f3f4; border-radius: 10px; font-size: 14px;">
        <h3>API Information:</h3>
        <ul>
          <li><strong>Word Counter:</strong> Built-in text analysis</li>
          <li><strong>Dictionary API:</strong> Free dictionary service for word definitions</li>
          <li><strong>Advice Slip API:</strong> Free advice API - returns random advice slips</li>
        </ul>
        <p><strong>Tip:</strong> Use the "Load Random Advice" button to get a piece of advice to analyze!</p>
      </div>
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.getElementById('text-input');
        const charCount = document.getElementById('char-count');
        const analyzeBtn = document.getElementById('analyze-btn');
        const loadAdviceBtn = document.getElementById('load-advice-btn');
        const sampleTextBtn = document.getElementById('sample-text-btn');
        const clearBtn = document.getElementById('clear-btn');
        
        // Update character count in real-time
        function updateCharCount() {
          const count = textarea.value.length;
          charCount.textContent = `${count} characters`;
        }
        
        textarea.addEventListener('input', updateCharCount);
        updateCharCount(); // Initial count
        
        // Clear button
        clearBtn.addEventListener('click', function() {
          textarea.value = '';
          updateCharCount();
          textarea.focus();
        });
        
        // Load Random Advice button
        loadAdviceBtn.addEventListener('click', async function() {
          const originalText = this.innerHTML;
          
          // Show loading state
          this.innerHTML = '<span class="loading"></span> Loading Advice...';
          this.disabled = true;
          
          try {
            // Fetch advice from our API endpoint
            const response = await fetch('/get_advice');
            const data = await response.json();
            
            // Insert advice into textarea
            if (textarea.value.trim()) {
              // If there's existing text, add the advice on a new line
              textarea.value = textarea.value + '\n\n"' + data.advice + '"';
            } else {
              // If textarea is empty, just set the advice
              textarea.value = '"' + data.advice + '"';
            }
            
            updateCharCount();
            textarea.focus();
            
            // Optional: Auto-scroll to the end
            textarea.scrollTop = textarea.scrollHeight;
            
          } catch (error) {
            console.error('Error fetching advice:', error);
            alert('Failed to load advice. Please try again.');
          } finally {
            // Restore button
            this.innerHTML = originalText;
            this.disabled = false;
          }
        });
        
        // Load Sample Text button
        sampleTextBtn.addEventListener('click', function() {
          const sampleText = `The journey of a thousand miles begins with a single step. This ancient wisdom reminds us that even the most daunting tasks can be accomplished by starting small. Every great achievement, whether in business, art, science, or personal growth, starts with that initial action. 

Procrastination often stems from feeling overwhelmed by the magnitude of a project. But by breaking it down into smaller, manageable pieces, we make progress possible. Each small step builds momentum and confidence, making the next step easier.

Success is not about perfection; it's about progression. Every day we have the opportunity to move forward, to learn something new, to improve ourselves in some small way. These incremental improvements compound over time, leading to significant results.

Remember that progress, not perfection, is the goal. Celebrate small victories along the way, and don't be discouraged by temporary setbacks. Keep moving forward, one step at a time.`;
          
          textarea.value = sampleText;
          updateCharCount();
          textarea.focus();
        });
        
        // Add keyboard shortcut: Ctrl+Enter to analyze, Ctrl+L to load advice
        document.addEventListener('keydown', function(e) {
          if (e.ctrlKey) {
            if (e.key === 'Enter') {
              e.preventDefault();
              analyzeBtn.click();
            } else if (e.key === 'l' || e.key === 'L') {
              e.preventDefault();
              loadAdviceBtn.click();
            }
          }
        });
      });
    </script>
  </body>
</html>
